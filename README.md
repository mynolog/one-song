## ğŸµ OneSong

### ğŸ“„ ì†Œê°œ

ì´ í”„ë¡œì íŠ¸ëŠ” 3ë…„ ì „ì— ê°œì¸ì ìœ¼ë¡œ ì§„í–‰í–ˆë˜ **ëœë¤ ìŒì•… ì¶”ì²œ** ì•„ì´ë””ì–´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒˆë¡­ê²Œ ë¦¬ë¹Œë“œí•œ ë²„ì „ì…ë‹ˆë‹¤.

ì´ˆê¸° í”„ë¡œì íŠ¸ëª…ì€ 'Music Roulette'ì´ì—ˆìœ¼ë‚˜, ë¦¬ë‰´ì–¼í•˜ë©´ì„œ í”„ë¡œì íŠ¸ì˜ ì»¨ì…‰ì„ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆëŠ” 'OneSong'ìœ¼ë¡œ ë³€ê²½í•˜ì˜€ìŠµë‹ˆë‹¤.

ì´ˆê¸° ë²„ì „ì€ `React`, `CSS Module`, `Shazam API`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°œë°œë˜ì—ˆìœ¼ë‚˜,  
í˜„ì¬ëŠ” `Next.js`ì™€ `TailwindCSS`ë¥¼ í™œìš©í•˜ì—¬ ì „ì²´ êµ¬ì¡°ì™€ UXë¥¼ ëŒ€ëŒ€ì ìœ¼ë¡œ ê°œì„ í•˜ì˜€ìŠµë‹ˆë‹¤.

ë˜í•œ ê¸°ì¡´ì— ì‚¬ìš©í–ˆë˜ `Shazam API`ì˜ ì£¼ìš” ê¸°ëŠ¥ì´ ëŒ€ë¶€ë¶„ deprecatedë˜ì–´,  
ìƒˆë¡œìš´ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í”„ë¡œì íŠ¸ë¥¼ ì¬êµ¬ì„±í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

### ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

- `Next.js` (App Router ê¸°ë°˜)
- `TypeScript`
- `TailwindCSS`
- `Zustand`
- `Jest`

### ğŸ“¦ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
ğŸ“ í”„ë¡œì íŠ¸ ë£¨íŠ¸
â”œâ”€â”€ __tests__/                   # í…ŒìŠ¤íŠ¸ í´ë” (srcì™€ ë™ì¼í•œ êµ¬ì¡°)
â”œâ”€â”€ public/                      # ì •ì  íŒŒì¼ (favicon, manifest ë“±)
â”œâ”€â”€ src/                         # ì• í”Œë¦¬ì¼€ì´ì…˜ ì†ŒìŠ¤ ì½”ë“œ
â”‚   â”œâ”€â”€ app/                     # Next.js ì•± ë¼ìš°íŒ… êµ¬ì¡°
â”‚   â”‚   â”œâ”€â”€ (with-audio)         # ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ê°€ ê³ ì •ëœ í˜ì´ì§€ ë ˆì´ì•„ì›ƒ ê·¸ë£¹
â”‚   â”‚   â”œâ”€â”€ api                  # Next.js API ë¼ìš°íŠ¸ (ì„œë²„ í•¨ìˆ˜ ê¸°ë°˜ í•¸ë“¤ëŸ¬)
â”‚   â”‚   â””â”€â”€ assets               # ì•± ì •ì  ìì‚°
â”‚   â”œâ”€â”€ components/              # ì¬ì‚¬ìš© ê°€ëŠ¥í•œ UI ë° ê¸°ëŠ¥ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ common/              # ê³µí†µ ì»´í¬ë„ŒíŠ¸ (AudioPlayer ë“±)
â”‚   â”‚   â”œâ”€â”€ country/             # ë©”ì¸ í˜ì´ì§€ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ guest/               # ë¹„íšŒì› ì „ìš© í˜ì´ì§€ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ icons/               # í”„ë¡œë°”ì´ë” ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ layouts/             # ë ˆì´ì•„ì›ƒ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ liked-songs/         # ì°œí•œ ë…¸ë˜ í˜ì´ì§€ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ me/                  # íšŒì› ì „ìš© í˜ì´ì§€ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â””â”€â”€ ui/                  # shadcn/ui ê¸°ë°˜ UI ì»´í¬ë„ŒíŠ¸ ë˜í¼
â”‚   â”œâ”€â”€ constants/               # ìƒìˆ˜ê°’ ì •ì˜ (êµ­ê°€ ì½”ë“œ ë“±)
â”‚   â”œâ”€â”€ hooks/                   # ì»¤ìŠ¤í…€ í›… ì •ì˜
â”‚   â”œâ”€â”€ lib/                     # ìœ í‹¸ í•¨ìˆ˜ ë° API fetch ë¡œì§
â”‚   â”œâ”€â”€ providers                # í”„ë¡œë°”ì´ë” ë˜í¼ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ stores/                  # Zustand ìƒíƒœ ê´€ë¦¬ ìŠ¤í† ì–´
â”‚   â”œâ”€â”€ types/                   # íƒ€ì… ì •ì˜
â”‚   â”œâ”€â”€ auth.ts                  # Auth.js í™˜ê²½ ì„¤ì •
â”‚   â””â”€â”€ middleware.ts            # Next.js ë¯¸ë“¤ì›¨ì–´
â”œâ”€â”€ jest.config.ts               # Jest ì„¤ì •
â”œâ”€â”€ tsconfig.json                # TypeScript ì„¤ì •
â”œâ”€â”€ README.md
â””â”€â”€ package.json
```

### ğŸ§  ìƒíƒœ ê´€ë¦¬ ì„¤ê³„ ì›ì¹™

- **ì „ì—­ ìƒíƒœ**

  - í•´ë‹¹ ìƒíƒœë¥¼ ì†Œë¹„í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì—ì„œ ì§ì ‘ ë¶ˆëŸ¬ì™€ì„œ ì‚¬ìš©
  - ì „ì—­ ìƒíƒœë¥¼ `props`ë¡œ ì „ë‹¬í•˜ëŠ” ë°©ì‹ì€ ì§€ì–‘

- **ì§€ì—­ ìƒíƒœ**
  - í•´ë‹¹ ìƒíƒœë¥¼ í•„ìš”ë¡œ í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì— `props`ë¡œ ì „ë‹¬í•˜ì—¬ ì‚¬ìš©
  - ì»´í¬ë„ŒíŠ¸ ëìŠ¤ê°€ 3ë‹¨ê³„ ì´ìƒ ë„˜ì–´ê°ˆ ê²½ìš° ì „ì—­ ìƒíƒœë¡œ ìŠ¹ê²© ê³ ë ¤

### âœ¨ êµ¬í˜„ ê¸°ëŠ¥

#### âœ… MVP (ìµœì†Œ ê¸°ëŠ¥ êµ¬í˜„)

- [x] ì¼ë¶€ êµ­ê°€ë³„ ëœë¤ ê³¡ ì¶”ì²œ
- [x] Apple Music RSS ê¸°ë°˜ ë¯¸ë¦¬ë“£ê¸° ì§€ì›
- [x] ê³¡ ì œëª©, ì•„í‹°ìŠ¤íŠ¸ëª…, ì•¨ë²”ì»¤ë²„, ì•¨ë²”ëª… ì •ë³´ ì œê³µ
- [x] ë¹„íšŒì› ì°œí•œ ë…¸ë˜ ëª¨ì•„ë³´ê¸° (ì „ì—­ ìƒíƒœ ê´€ë¦¬ + ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì—°ë™)

#### â• ì¶”ê°€ êµ¬í˜„

- [x] ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ì»¤ìŠ¤í„°ë§ˆì´ì§• (ì¬ìƒ / ì¼ì‹œì •ì§€ / ì •ì§€ / ì¬ìƒ ìœ„ì¹˜ í‘œì‹œ)
- [x] êµ­ê°€ ì„ íƒ ë“œë¡­ë‹¤ìš´ ë©”ë‰´
- [x] ìµœê·¼ ì¶”ì²œ ê¸°ë¡ ì €ì¥
- [x] íšŒì› ê¸°ëŠ¥ ë„ì… ë° ê°œë³„ ì°œí•œ ë…¸ë˜ ëª¨ì•„ë³´ê¸° (`Auth.js` + `Supabase DB`)
- [ ] í•µì‹¬ ë¡œì§ ìœ ë‹› í…ŒìŠ¤íŠ¸ ë° ë Œë”ë§ í…ŒìŠ¤íŠ¸

#### ğŸ›  êµ¬í˜„ ì˜ˆì •

- [ ] ì•„í‹°ìŠ¤íŠ¸ / ì•¨ë²” ìƒì„¸ í˜ì´ì§€ êµ¬í˜„ (í˜„ì¬ëŠ” ì™¸ë¶€ ë§í¬ ì²˜ë¦¬ë¡œ ëŒ€ì²´)
- [ ] ë‹¤êµ­ì–´ ëŒ€ì‘
- [ ] í…ŒìŠ¤íŠ¸ ì½”ë“œ ë° ë°°í¬ ìë™í™”

### ğŸ§© íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

- [ ] ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ì»´í¬ë„ŒíŠ¸: ì¬ìƒ ì¤‘ ë¦¬ë Œë”ë§ ë°œìƒ (2025.05.05)

  - ì›ì¸
    - Progressê°€ ëŠê¸°ë“¯ ì›€ì§ì—¬ `requestAnimationFrame`ì„ ì ìš©í•´ì„œ UIëŠ” ê°œì„ ë˜ì—ˆìœ¼ë‚˜ `currentTime` ìƒíƒœë¥¼ ë§¤ í”„ë ˆì„ ì—…ë°ì´íŠ¸í•˜ì—¬ ê³¼ë„í•œ ë¦¬ë Œë”ë§ ìœ ë°œ
  - ì‹œë„í•œ ë°©ë²•
  - ê²°ê³¼

- [x] ì²« ë¡œê·¸ì¸ ì‹œ, ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ë¡œ ì¸ì‹ë˜ì–´ íšŒì›ê°€ì… ì²˜ë¦¬ê°€ ë˜ì§€ ì•ŠìŒ (2025.05.07)

  - ì´ˆê¸°ì— ì¶”ì •í•œ ì›ì¸

    - ë¡œê·¸ì¸ ì‹œ `/` í˜ì´ì§€ì—ì„œ ë‹¤ì‹œ `/country/[code]` ë¼ìš°í„°ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë˜ë©´ì„œ `AuthUserInitializer`ê°€ ë‘ë²ˆ ì‹¤í–‰ë˜ì–´ì„œ `createUser` ë©”ì„œë“œê°€ ë‘ ë²ˆ í˜¸ì¶œë¨
    - ì´ë¡œ ì¸í•´ ì¤‘ë³µ íšŒì› ìƒì„± ì‹œë„ë¡œ ì¸í•œ `insert` ì‹¤íŒ¨ë¡œ ì¶”ì •

  - ì‹¤ì œ ì›ì¸

    - `AuthUserInitializer` ë‚´ ì‚¬ì´ë“œ ì´í™íŠ¸ê°€ ë‘ê°œë¡œ ë¶„ë¦¬ë˜ì–´ ìˆìŒ
      - 1. ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸ -> ì—†ìœ¼ë©´ `insert`
      - 2. ì°œí•œ ë…¸ë˜ ëª©ë¡ì„ localStorage -> Supabase DBë¡œ ì´ê´€ + ìƒíƒœ í”Œë˜ê·¸ ì—…ë°ì´íŠ¸
    - ë¹„ë™ê¸° ì‹¤í–‰ ìˆœì„œê°€ ë³´ì¥ë˜ì§€ ì•Šì•„ `insert` -> `select`ì™€ `select` -> `insert` ë ˆì´ìŠ¤ ë°œìƒí•˜ì—¬ íƒ€ì´ë°ì— ë”°ë¼ `insert`ì—ì„œ ì¤‘ë³µí‚¤ ì—ëŸ¬ ë°œìƒ

  - í•´ê²° ë°©ë²•
    - `insert` ëŒ€ì‹  `upsert`ë¡œ ë³€ê²½í•˜ì—¬ ì´ë©”ì¼ì´ ì¡´ì¬í•˜ë©´ ë„˜ì–´ê°€ê³  ì—†ìœ¼ë©´ ìƒˆë¡œ ì‚½ì…í•˜ì—¬ êµ¬ì¡° ì•ˆì •ì„± í™•ë³´
    ```ts
    const { data, error } = await supabase
      .from('users')
      .upsert(
        [
          {
            email,
            name: name ?? null,
            avatar_url: image ?? null,
            provider,
          },
        ],
        {
          onConflict: 'email',
        },
      )
      .select('id')
      .single()
    ```

- [x] Production í™˜ê²½ì—ì„œ `getToken()`ì´ í•­ìƒ `null`ì„ ë°˜í™˜í•˜ì—¬ í”„ë¼ì´ë¹— ë¼ìš°í„° ì‘ë™ ì•ˆí•¨ (2025.05.08)
  - ì›ì¸
    - Auth.js + App Router í”„ë¡œì íŠ¸ì—ì„œ `cookieName`ì´ ë³´ì•ˆ ìƒì˜ ì´ìœ ë¡œ `__Secure-authjs.session-token`ìœ¼ë¡œ ë³€ê²½ë¨
    - `getToken()`ì€ ê¸°ë³¸ì ìœ¼ë¡œ `next-auth.session-token`ë§Œ ì¸ì‹
    - ì¿ í‚¤ëŠ” ë¸Œë¼ìš°ì € ìƒ ì¡´ì¬í•˜ì§€ë§Œ, `getToken()`ì´ `cookieName`ì„ ì°¾ì§€ ëª»í•˜ì—¬ `null`ì„ ë°˜í™˜
  - í•´ê²° ë°©ë²•
    - `src/moddileware.ts` ë‚´ `getToken()` í˜¸ì¶œ ì‹œ `cookieName`ì„ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •
    ```ts
    const token = await getToken({
      req: request,
      secret: process.env.AUTH_SECRET,
      cookieName: '__Secure-authjs.session-token',
    })
    ```

### ğŸŒ¿ ë¸Œëœì¹˜ ì •ë³´

- `main` â€” ë¦¬ë‰´ì–¼ëœ ë²„ì „
- `legacy/main` â€” ë ˆê±°ì‹œ ë²„ì „ (ë°°í¬ ì¤‘ë‹¨, ì½”ë“œë§Œ í™•ì¸ ê°€ëŠ¥)
